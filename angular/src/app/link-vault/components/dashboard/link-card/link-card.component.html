<div class="card h-100 border-0 shadow-sm link-card" (click)="onVisit()">
    <div class="card-body p-4 d-flex flex-column">
        <div class="d-flex align-items-start mb-3">
            <div class="me-3">
                <div class="icon-wrapper rounded-3 d-flex align-items-center justify-content-center shadow-sm"
                    [style.background-color]="getColorForDomain(link.domain)">
                    <img *ngIf="link.favicon; else defaultIcon" [src]="link.favicon" class="favicon-img" alt="icon"
                        onerror="this.style.display='none'">
                    <ng-template #defaultIcon>
                        <i class="fas fa-link text-white fs-5"></i>
                    </ng-template>
                </div>
            </div>
            <div class="overflow-hidden flex-grow-1">
                <h5 class="card-title fw-bold text-dark text-truncate mb-1" title="{{ link.title }}">
                    {{ link.title }}
                </h5>
                <p class="card-subtitle text-muted small text-truncate">
                    {{ link.domain }}
                </p>
            </div>
        </div>

        <p class="card-text text-muted small mb-3 line-clamp-2" title="{{ link.description }}">
            {{ link.description || 'No description available.' }}
        </p>

        <div class="mt-auto">
            <div class="d-flex flex-wrap gap-1 mb-3">
                <span *ngFor="let tag of link.tags"
                    class="badge bg-light text-primary border fw-normal px-2 py-1 footer-badge">
                    {{ tag.name }}
                </span>
                <span *ngIf="link.collectionName"
                    class="badge bg-light text-secondary border fw-normal px-2 py-1 footer-badge">
                    <i class="fas fa-folder me-1"></i> {{ link.collectionName }}
                </span>
            </div>

            <div class="d-flex align-items-center justify-content-between pt-3 border-top border-light">
                <div class="small text-muted d-flex flex-column">
                    <span>Added {{ link.creationTime | date:'mediumDate' }}</span>
                    <span class="text-xs">Opened {{ link.visitCount }} times</span>
                </div>

                <div class="d-flex gap-2 stop-propagation" *ngIf="!trashMode">
                    <button class="btn btn-icon btn-sm rounded-circle" [class.text-warning]="link.isFavorite"
                        [class.text-muted]="!link.isFavorite" (click)="$event.stopPropagation(); favorite.emit(link)"
                        ngbTooltip="Favorite">
                        <i [class]="link.isFavorite ? 'fas fa-star' : 'far fa-star'"></i>
                    </button>
                    <button class="btn btn-icon btn-sm rounded-circle" [class.text-info]="link.hasReminder"
                        [class.text-muted]="!link.hasReminder" (click)="$event.stopPropagation(); reminder.emit(link)"
                        [ngbTooltip]="link.hasReminder ? 'Reminder set' : 'Set reminder'">
                        <i [class]="link.hasReminder ? 'fas fa-bell' : 'far fa-bell'"></i>
                    </button>
                    <button class="btn btn-icon btn-sm rounded-circle text-muted hover-primary"
                        (click)="$event.stopPropagation(); edit.emit(link)" ngbTooltip="Edit">
                        <i class="fas fa-pencil-alt"></i>
                    </button>
                    <button class="btn btn-icon btn-sm rounded-circle text-muted hover-danger"
                        (click)="$event.stopPropagation(); delete.emit(link)" ngbTooltip="Delete">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>

                <div class="d-flex gap-2 stop-propagation" *ngIf="trashMode">
                    <button class="btn btn-icon btn-sm rounded-circle text-success hover-success"
                        (click)="$event.stopPropagation(); restore.emit(link)" ngbTooltip="Restore">
                        <i class="fas fa-trash-restore"></i>
                    </button>
                    <button class="btn btn-icon btn-sm rounded-circle text-danger hover-danger"
                        (click)="$event.stopPropagation(); hardDelete.emit(link)" ngbTooltip="Delete Forever">
                        <i class="fas fa-ban"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>